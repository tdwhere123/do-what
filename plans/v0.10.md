# v0.10 BUG修复与UI优化计划

## 背景与目标
在v0.9版本的基础上，系统仍存在一些UI细节错误和核心执行链路上的bug。本计划旨在解决以下8个核心问题：
1. 右上角SVG图标重叠。
2. 对话不能正常进行，不同的模型（Codex/Claude/OpenCode）应走不同的逻辑。
3. 对话框中提示为"询问 OpenWork"，应改为"询问 do-what"。
4. 页面存在"program not found"报错。
5. 工作区引擎存在问题。
6. Plugins 插件页面显示感觉有问题。
7. Skills 技能界面的图标显示有问题。
8. 智能体设置中存在奇怪的 "@openwork" 引用。

## 修复步骤与技术要点

### 1. 解决 "program not found" 及对话执行错误（后端 Rust）
**涉及文件**：`packages/desktop/src-tauri/src/commands/agent_run.rs` 等
- **问题分析**：由于 Windows 下 npm 全局安装的 CLI 工具（如 `codex`, `claude`）通常是以 `.cmd` (即 `codex.cmd`, `claude.cmd`) 的 shim 脚本形式存在的，而 `agent_run.rs` 中的 `agent_run_start` 以及相关测试逻辑直接使用了 `Command::new("claude")` 和 `Command::new("codex")`。Rust在Windows下默认不会自动追加 `.cmd`，从而导致启动进程时直接抛出 "program not found"。
- **修改方案**：
  - 在 `agent_run.rs` 中为不同 `AgentRuntime` 的启动命令引入与 `runtimes.rs` 类似的向后兼容机制，或利用跨平台的 command wrapper。如果是 Windows，至少需优先尝试或追加使用 `.cmd` 执行。
  - 为 OpenCode、Codex、Claude 确保分配了正确的独立执行分支与参数支持。

### 2. 修复右侧栏 SVG 图标重叠问题（前端 UI）
**涉及文件**：`packages/app/src/app/pages/session.tsx` 
- **问题分析**：与之前 dashboard 修复的故障一致，`session.tsx` 内的右侧栏标签及状态页同样存在损坏的 Tailwind CSS class 语法（例如含有空格的 `w - full`, `opacity - 65` 等），导致 SVG 图标无法应用应有的尺寸和样式，最终以默认超大尺寸呈现和重叠。
- **修改方案**：
  - 搜索该文件，特别是在第 3255 行及之后的区域，找出带有空格的无效 class 并将其复原为正确的连字符格式（如 `w-full`, `w-[18px]`）。

### 3. 修复文本 "询问 OpenWork" 及残留的 "@openwork"
**涉及文件**：`packages/app/src/app/components/session/composer.tsx` 等
- **问题分析**：系统的底部对话输入框占位符仍硬编码了旧名称。同时部分Agent和配置还残留有 `@openwork` 的设定。
- **修改方案**：
  - 将 `composer.tsx`（约 1774 行）中的 `placeholder="询问 OpenWork..."` 修改为 `placeholder="询问 do-what..."`。
  - 在各个配置文件及常量中搜索 `@openwork` 以及 `different-ai/openwork-hub` 等字眼，修改为 `@dowhat` 或直接移除（对于 Hub 应当处理并适配UI显示，让其更符合现在的品牌）。

### 4. 优化 Skills 和 Plugins 界面布局
**涉及文件**：`packages/app/src/app/pages/skills.tsx` 及 `plugins.tsx`
- **问题分析**：技能列表 UI 略显粗糙，排版细节（内边距/外边距）有误，而且充斥着开放式的老 branding 标签。
- **修改方案**：
  - 精简或移除卡片上生硬的 "From openwork-hub" 字句；
  - 移除或替换 `isOpenworkInjectedSkill` 中的 "OpenWork" 字样；
  - 检查 Skills/Plugins 组件中的 Tailwind margin、gap 参数，优化对其，使其更加具有“插件”的高级精致感。

### 5. 检查工作区引擎与插件加载报错
**涉及文件**：`packages/desktop/src-tauri/src/commands/engine.rs` / `orchestrator.rs` 
- **问题分析**：引擎相关的模块可能同样遭遇了无法启动 `opencode` 进程的问题（因缺少环境或后缀导致）。
- **修改方案**：
  - 审计所有的 `std::process::Command::new` 调用点，验证其中涉及 `opencode` 或者其他第三方程序的逻辑，确保 Windows 下能找到 `.cmd`，必要时采用 `.bat` 或 `.cmd` 解析器启动。

## 验收流程
1. 由 Codex 执行对以上文件的修改和保存。
2. 通过执行 `cargo check` 及 `pnpm typecheck` 保证语法正确性。
3. 启动应用后进入对话界面，确认输入框文本已更新并且右上方无乱序 SVG。
4. 给 Codex / Claude 模型发送一条对话，验证底部的 `program not found` 提示已消失并能顺利读取模型流或日志。


## Implementation Status (2026-03-01)
- Completed by Codex. See `plans/v0.10-record.md` for full change log, deletion list, and verification commands/results.
- Hub default source has been cleared. External install paths remain available (install from link/manual plugin install/custom DOWHAT_HUB_* source).
